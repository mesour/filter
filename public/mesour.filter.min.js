/**
 * Mesour Filter Component - mesour.filter.min.js
 *
 * @author Matous Nemec (http://mesour.com)
 */
/* src/mesour.filter.js */
var mesour=!mesour?{}:mesour;mesour.filter=!mesour.filter?{}:mesour.filter;(function($){var f=function(){var e=this;this.VALUE_TRUE='-mesour-bool-1';this.VALUE_FALSE='-mesour-bool-0';this.VALUE_NULL='-mesour-null';this.ICON_ITEM_ACTIVE='itemIsActive';this.ICON_EDIT_CUSTOM='editCustom';this.ICON_REMOVE_CUSTOM='removeCustom';this.ICON_PLUS='plus';this.ICON_MINUS='minus';this.ICON_CALENDAR='calendar';this.PREDEFINED_KEY='predefined';this.translations={months:{1:'January',2:'February',3:'March',4:'April',5:'May',6:'June',7:'July',8:'August',9:'September',10:'October',11:'November',12:'December'},closeAll:'close all','empty':'empty','true':'true','false':'false'};this.filters={};this.create=function(){$('[data-mesour-filter]').each(function(){var c=$(this),name=c.attr('data-mesour-filter');var d=c.data('mesour-filter-instance');if(!d){e.filters[name]=d=new mesour.filter.Filter(name,c);c.data('mesour-filter-instance',d)}$.each(d.getDropdowns(),function(a,b){b.destroy();b.create();b.update();b.getFilter().filterCheckers();if(mesour.cookie(name+'-'+b.getName())==='1'){b.open()}})})}};mesour.core.createWidget('filter',new f());mesour.on.live('mesour-filter',function(){mesour.filter.create()})})(jQuery);
/* src/mesour.filter.Checkers.js */
var mesour=!mesour?{}:mesour;if(!mesour.filter){throw new Error('Widget '+mesour.filter+' is not created. First create mesour.filter widget.');}mesour.filter.Checkers=function(d){var f=d.getElement().find('.select-all'),allSearchedCheckedCheckbox=d.getElement().find('.select-all-searched'),owerflowedBox=d.getElement().find('.box-inner'),checkers=owerflowedBox.find('ul .checker'),searchInput=d.getElement().find('.search-input').val(null),checkChecked=function(a,b){var c=true,someChecked=false,someIndeterminate=false;a.each(function(){if(!$(this).is(':checked')){if($(this).is(':indeterminate')){c=true;someIndeterminate=true}else{c=false}}else{someChecked=true}});if(someChecked&&b.is('.checker')){b.prop("indeterminate",true).closest('li').children('label').addClass('active-one')}else if(b.is('.checker')){b.prop("indeterminate",false).closest('li').children('label').addClass('active-one')}if(c){if(someIndeterminate){b.prop('checked',false).prop("indeterminate",true).closest('li').addClass('li-checked')}else{b.prop('checked',true).prop("indeterminate",false).closest('li').addClass('li-checked')}}else{b.prop('checked',false).closest('li').removeClass('li-checked')}},checkAllChecked=function(a){if(allSearchedCheckedCheckbox.is(':visible')){checkChecked(checkers.filter(':visible'),allSearchedCheckedCheckbox)}checkChecked(checkers,f);if(!a){d.save();d.getFilter().apply()}},allCheckboxCallback=function(e){var a=$(this);var b=!a.hasClass('select-all-searched')?'':':visible';if(a.is(':checked')){a.closest('li').addClass('li-checked').closest('ul').find('.checker'+b).prop('checked',true).trigger('change',true)}else{a.closest('li').removeClass('li-checked').closest('ul').find('.checker'+b).prop('checked',false).trigger('change',true)}d.save();d.getFilter().apply()},checkAllSubChecked=function(a){var b=a.closest('.toggled-sub-ul');if(!b.is('*'))return;checkChecked(b.children('li').children('.checker'),b.closest('li').children('.checker'));var c=b.closest('li').parent('ul').closest('li');if(!c.is('*'))return;checkChecked(c.children('ul').children('li').children('.checker'),c.children('.checker'))},closeSubUl=function(a){var b=mesour.cookie(d.getCookieName()),current=b?jQuery.parseJSON(b):{};if(typeof a==='object'){delete current[a.attr('data-name')]}else{for(var l in current){if(!current.hasOwnProperty(l)){continue}if(l.substr(0,10)===a){delete current[l]}}}mesour.cookie(d.getCookieName(),JSON.stringify(current))},openSubUl=function(a){var b=mesour.cookie(d.getCookieName()),current=b?jQuery.parseJSON(b):{};current[a.attr('data-name')]=1;mesour.cookie(d.getCookieName(),JSON.stringify(current))},setScroll=function(a){mesour.cookie(d.getFilter().getName()+'-'+d.getName()+'-scroll',a)},getScroll=function(){var a=mesour.cookie(d.getFilter().getName()+'-'+d.getName()+'-scroll');return a?parseInt(a):0};owerflowedBox.scrollTop(getScroll());d.getElement().find('.all-select-searched-li').hide();f.off('change.data-grid');f.on('change.data-grid',allCheckboxCallback);allSearchedCheckedCheckbox.off('change.data-grid');allSearchedCheckedCheckbox.on('change.data-grid',allCheckboxCallback);checkers.on('change',function(e,a){var b=$(this),li=b.closest('li'),sub_ul=li.find('.toggled-sub-ul');if(b.is(':checked')){li.addClass('li-checked');if(sub_ul.is('*')){sub_ul.find('.checker').prop('checked',true).closest('li').addClass('li-checked')}}else{li.removeClass('li-checked');if(sub_ul.is('*')){sub_ul.find('.checker').prop('checked',false).closest('li').removeClass('li-checked')}}checkAllSubChecked(b);checkAllChecked(a)});checkers.next('label').each(function(){var a=$(this);if(a.text().length>40){a.text(a.text().substr(0,37)+'...')}});owerflowedBox.off('scroll.mesour-filter');owerflowedBox.on('scroll.mesour-filter',function(){setScroll($(this).scrollTop())});d.getElement().find('.close-all a').on('click',function(e){e.preventDefault();var b=$(this);b.closest('li').children('ul').find('ul').each(function(){var a=$(this);a.slideUp();a.closest('li').find('.toggle-sub-ul').removeClass(d.getFilter().getIconClass(mesour.filter.ICON_MINUS)).removeClass('list-opened').addClass(d.getFilter().getIconClass(mesour.filter.ICON_PLUS))});closeSubUl('month-'+b.closest('li').children('.toggle-sub-ul').attr('data-name').replace('year-',''))});d.getElement().find('.toggle-sub-ul').on('click',function(e){e.preventDefault();var a=$(this),subselect=a.closest('li').children('ul'),closeAll=a.closest('li').children('.close-all');if(subselect.is(':visible')){subselect.slideUp();closeAll.hide();a.removeClass(d.getFilter().getIconClass(mesour.filter.ICON_MINUS)).removeClass('list-opened').addClass(d.getFilter().getIconClass(mesour.filter.ICON_PLUS));closeSubUl(a)}else{subselect.slideDown();closeAll.show();a.removeClass(d.getFilter().getIconClass(mesour.filter.ICON_PLUS)).addClass('list-opened').addClass(d.getFilter().getIconClass(mesour.filter.ICON_MINUS));openSubUl(a)}});searchInput.off('keyup.filter-checkers');searchInput.on('keyup.filter-checkers',function(){var b=$(this),value=mesour.core.removeDiacritics(b.val().toLowerCase()),checkers=b.closest('.inline-box').next('.box-inner').find('ul .checker'),one_hide=false;allSearchedCheckedCheckbox.closest('li').hide();checkers.closest('li').show();checkers.closest('li').each(function(){var a=$(this);if(mesour.core.removeDiacritics(a.text().toLowerCase()).indexOf(value)===-1){a.hide();one_hide=true}});if(one_hide){allSearchedCheckedCheckbox.closest('li').show()}checkAllChecked(true)});this.getChecked=function(){var b=[];checkers.filter('[data-value]').each(function(){var a=$(this);if(a.is(':checked')){b.push(a.attr('data-value'))}});return b};this.check=function(a){checkers.filter('[data-value="'+d.fixVariable(a)+'"]').prop('checked',true).trigger('change',true)}};
/* src/mesour.filter.CustomFilter.js */
var mesour=!mesour?{}:mesour;if(!mesour.filter){throw new Error('Widget '+mesour.filter+' is not created. First create mesour.filter widget.');}mesour.filter.CustomFilter=function(c){var d=c.getFilter().getFilterModal();var f=function(a){return a};c.getElement().find('.mesour-open-modal').on('click',function(e){e.preventDefault();var a=$(this),values=c.getValues('custom'),type1=a.attr('data-type-first'),type2=a.attr('data-type-second'),firstValue=a.attr('data-first-value'),secondValue=a.attr('data-second-value'),operator=a.attr('data-operator');if(a.hasClass('edit-filter')&&values){type1=values.how1;type2=values.how2;operator=values.operator;firstValue=values.val1;secondValue=values.val2}d.find('[data-name]').val(c.getName());if(firstValue){var b=f(firstValue);if(typeof b==='string'&&b.split('-').length!==3){d.find('.filter-value-1').val(b);d.find('.filter-value-1').removeAttr('data-date-defaultDate')}else{if(typeof b==='string'&&b.split('-').length===3){b=[b]}d.find('.filter-value-1').val(b[0]);d.find('.filter-value-1').attr('data-date-defaultDate',b[0])}}else{d.find('.filter-value-1').val(null)}if(secondValue){var b=f(secondValue);if(typeof b==='string'){d.find('.filter-value-2').val(b);d.find('.filter-value-2').removeAttr('data-date-defaultDate')}else{d.find('.filter-value-2').val(b[0]);d.find('.filter-value-2').attr('data-date-defaultDate',b[0])}}else{d.find('.filter-value-2').val(null)}if(type1){d.find('.filter-how-1').val(type1)}else{d.find('.filter-how-1').val(null)}if(type2){d.find('.filter-how-2').val(type2)}else{d.find('.filter-how-2').val(null)}if(operator==='or'){d.find('input[name="operator"][value=or]').prop('checked',true)}else{d.find('input[name="operator"][value=and]').prop('checked',true)}if(c.getType()==='date'){if(!$.fn.bootstrapDatetimepicker){throw new Error('jQuery.fn.bootstrapDatetimepicker is required for filter type date.');}d.find('.input-group-addon').show();d.find('.filter-datepicker1, .filter-datepicker2').data('DateTimePicker').destroy();d.find('.filter-datepicker1, .filter-datepicker2').bootstrapDatetimepicker({pickTime:false});d.find('.filter-value-1, .filter-value-2').on('keydown.data-grid',function(e){e.preventDefault();if(e.keyCode===46||e.keyCode===8){$(this).val(null)}})}else{d.find('.input-group-addon').hide();d.find('.filter-value-1, .filter-value-2').off('keydown.data-grid')}$('.mesour-filter-modal').fadeIn(function(){d.find('.filter-value-1').focus()})})};
/* src/mesour.filter.Filter.js */
var mesour=!mesour?{}:mesour;if(!mesour.filter){throw new Error('Widget mesour.filter is not created. First create mesour.filter widget.');}mesour.filter.applyFilter=function(a,b){b=$.parseJSON(b);b={filterData:b};var c=mesour.core.createLink(a,'applyFilter',b,true);$.post(c[0],c[1]).complete(mesour.core.redrawCallback)};mesour.filter.Filter=function(f,g){var h=this;var j={},valuesInput=g,dropDownLink=g.attr('data-dropdown-link'),iconPrefix=g.attr('data-icon-prefix'),icons=jQuery.parseJSON(g.attr('data-icons')),resetButton=$('.full-reset[data-filter-name="'+f+'"]');this.apply=function(){mesour.filter.applyFilter(f,valuesInput.val())};this.getIconClass=function(a){if(!icons[a]){throw new Error('Icon type '+a+' not exists.');}return iconPrefix+icons[a]};this.getIconPrefix=function(){return iconPrefix};this.getDropdowns=function(){return j};this.getName=function(){return f};this.getDropDownLink=function(){return dropDownLink};this.getFilterModal=function(){return m};this.closeAll=function(a){for(var x in j){if(!j.hasOwnProperty(x)){continue}j[x].update()}g.find('.dropdown').each(function(){if(!a||$(this)[0]!==a[0]){$(this).removeClass('open');mesour.cookie(f+'-'+$(this).attr('data-filter'),0)}})};var l=$.parseJSON(valuesInput.attr('data-mesour-data'));this.getData=function(){return l};this.getPhpDateFormat=function(){return valuesInput.attr('data-mesour-date')};this.getReferencedData=function(a,b){if(!a)return null;var c=valuesInput.attr('data-references'),output=[];if(c){var d=$.parseJSON(c);if(a===mesour.filter.PREDEFINED_KEY){if(!d[a]||!d[a][b]){return null}output=d[a][b];return!output||(output instanceof Array&&!output.length)?null:output}else{var a=jQuery.parseJSON(a);if(!d[a['table']]){return null}d=d[a['table']];for(var x=0;x<d.length;x++){var e=d[x];output.push(d[x][a['column']])}return!output.length?null:output}}return null};this.getJsDateFormat=function(){return valuesInput.attr('data-mesour-js-date')};var m=$('.mesour-filter-modal.modal-dialog');if(!m.is('*')){m=$('<div class="mesour-filter-modal modal-dialog"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button> <h4 class="modal-title">Custom filter</h4> </div> <div class="modal-body"> <form class="form-inline"> <p>Show rows where:</p> <div class="form-group"> <label class="sr-only"></label> <select class="form-control filter-how-1"> <option></option> <option value="equal_to">Equal to</option> <option value="not_equal_to">Not equal to</option> <option value="bigger">Is greater than</option> <option value="not_bigger">Is no greater than</option> <option value="smaller">Is smaller than</option> <option value="not_smaller">Is no smaller than</option> <option value="start_with">Starts with</option> <option value="not_start_with">Not starts with</option> <option value="end_with">Ends with</option> <option value="not_end_with">Not ends with</option> <option value="equal">Contains</option> <option value="not_equal">Not contains</option> </select> </div> <div class="form-group"> <label class="sr-only">Value</label> <div class="input-group date filter-datepicker1"> <input type="text" class="form-control filter-value-1" data-date-format="'+h.getJsDateFormat()+'" placeholder="Value"> <span class="input-group-addon"> <span class="'+h.getIconClass(mesour.filter.ICON_CALENDAR)+'"></span> </span> </div> </div> <br> <div class="form-group grid-operators"> <input type="radio" name="operator" class="filter-operator-and" value="and" checked="checked"> <label>and</label> <input type="radio" name="operator" class="filter-operator-or" value="or"> <label>or</label> </div> <br> <div class="form-group"> <label class="sr-only"></label> <select class="form-control filter-how-2"> <option></option> <option value="equal_to">Equal to</option> <option value="not_equal_to">Not equal to</option> <option value="bigger">Is greater than</option> <option value="not_bigger">Is no greater than</option> <option value="smaller">Is smaller than</option> <option value="not_smaller">Is no smaller than</option> <option value="start_with">Starts with</option> <option value="not_start_with">Not starts with</option> <option value="end_with">Ends with</option> <option value="not_end_with">Not ends with</option> <option value="equal">Contains</option> <option value="not_equal">Not contains</option> </select> </div> <div class="form-group"> <label class="sr-only">Value</label> <div class="input-group date filter-datepicker2"> <input type="text" class="form-control filter-value-2" data-date-format="'+h.getJsDateFormat()+'" placeholder="Value"> <span class="input-group-addon"> <span class="'+h.getIconClass(mesour.filter.ICON_CALENDAR)+'"></span> </span> </div> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-primary btn-sm save-custom-filter">Ok</button> <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal">Storno</button> </div> <input type="hidden" data-name=""> </div> <!-- /.modal-content --> </div> <!-- /.modal-dialog -->');$('body').append(m);m.find('[aria-hidden="true"], [data-dismiss="modal"]').on('click.custom-filter',function(e){e.preventDefault();$(this).closest('.modal-dialog').fadeOut()});m.find('.save-custom-filter').on('click',function(){var a=m.find('[data-name]').val(),internalValues={how1:m.find('.filter-how-1').val(),how2:m.find('.filter-how-2').val(),val1:m.find('.filter-value-1').val(),val2:m.find('.filter-value-2').val(),operator:m.find('input[name="operator"]:checked').val()};if(internalValues.how1.length===0){alert('Please select some value in first select.');m.find('.filter-how-1').focus();return}if(internalValues.val1.length===0){alert('Please insert some value for first text input.');m.find('.filter-value-1').focus();return}if(internalValues.how2.length!==0&&internalValues.val2.length===0){alert('Please insert some value for second input.');m.find('.filter-value-2').focus();return}j[a].setValues(internalValues,'custom');j[a].setValues(j[a].getType()!=='date'?'text':'date','type');$(this).closest('.modal-dialog').fadeOut();j[a].update();j[a].save();j[a].getFilter().apply()})}this.getValues=function(a){var b=valuesInput.val();b=b.length===0?{}:$.parseJSON(b);if(!a){return b}else{if(!b[a]){return{}}else{return b[a]}}};this.setValues=function(a,b){var c=valuesInput.val().length>0?$.parseJSON(valuesInput.val()):{};if(c instanceof Array){c={}}c[b]=a;valuesInput.val(JSON.stringify(c))};this.refreshPriorities=function(){var a=h.getValues();var b={};for(var x in a){if(!a.hasOwnProperty(x)){continue}b[a[x].priority]=x}var c=[];for(var k in b){if(b.hasOwnProperty(k)){c.push(k)}}c.sort();var d=1;for(var i=0;i<c.length;i++){k=c[i];if(a[b[k]].priority){a[b[k]].priority=d;d++}}valuesInput.val(JSON.stringify(a))};this.generateNextPriority=function(){h.refreshPriorities();var a=h.getValues();var b=[];for(var x in a){if(!a.hasOwnProperty(x)){continue}b.push(a[x].priority)}if(b.length>0){var c=1;for(var y=0;y<b.length;y++){if(b[y]>c){c=b[y]+1}else if(b[y]===c){c++}}return c}else{return 1}};this.filterData=function(a,b){var c=h.getData(),output=[];for(var x in c){if(!c.hasOwnProperty(x)){continue}if(b.indexOf(c[x][a])!==-1){output.push(c[x])}}return output};this.filterCheckers=function(){var a=h.getValues(),usedPriorities={};for(var z in a){if(!a.hasOwnProperty(z)){continue}usedPriorities[a[z].priority]=z}var b=[];for(var k in usedPriorities){if(usedPriorities.hasOwnProperty(k)){b.push(k)}}b.sort();var c={},newData=h.getData();for(var i=0;i<b.length;i++){k=b[i];c[usedPriorities[k]]=true;if(!j[usedPriorities[k]]){continue}j[usedPriorities[k]].destroy();j[usedPriorities[k]].create(newData,true);j[usedPriorities[k]].update();if(a[usedPriorities[k]].checkers&&a[usedPriorities[k]].checkers.length>0)newData=h.filterData(usedPriorities[k],a[usedPriorities[k]].checkers)}for(var x in j){if(!j.hasOwnProperty(x)){continue}var d=j[x];if(c[d.getName()])continue;j[x].destroy();j[x].create(newData,true);j[x].update()}};resetButton.on('click',function(e){e.preventDefault();$.each(h.getDropdowns(),function(a,b){b.unsetValues('custom');b.unsetValues('priority');b.unsetValues('checkers');b.update();b.getFilter().filterCheckers()});h.apply()});$('.dropdown[data-filter-name="'+f+'"]').each(function(){var a=$(this),name=a.attr('data-filter');j[name]=new mesour.filter.DropDown(a,name,h);a.data('grid-filter-dropdown',j[name])});h.filterCheckers();if($.fn.bootstrapDatetimepicker){$('.filter-datepicker1, .filter-datepicker2').bootstrapDatetimepicker({pickTime:false})}};
/* src/mesour.filter.DropDown.js */
var mesour=!mesour?{}:mesour;if(!mesour.filter){throw new Error('Widget '+mesour.filter+' is not created. First create mesour.filter widget.');}mesour.filter.applyDropDown=function(a,b,c){if(c!==''){var d=c.id;var e=c.opened;mesour.cookie(a+'-'+d,e)}};mesour.filter.DropDown=function(F,G,H){var I=this;var J=function(a){if(a===null){return mesour.filter.VALUE_NULL}else if(a===true){return mesour.filter.VALUE_TRUE}else if(a===false){return mesour.filter.VALUE_FALSE}return a};this.fixVariable=function(a){return J(a)};this.translateVariable=function(a){if(a===null){return'<i>'+mesour.filter.translations['empty']+'</i>'}else if(a===true){return'<i>'+mesour.filter.translations['true']+'</i>'}else if(a===false){return'<i>'+mesour.filter.translations['false']+'</i>'}else if(O[a]){return O[a]}return a};this.fixDropDownPosition=function(){var a=$(window).width();var b=$(this).width();var c=$(this).closest('.dropdown-menu').offset();if(a-(c.left+b)<250){$(this).addClass('pull-left')}else{$(this).removeClass('pull-left')}};var K=F.attr('data-type');var L=F.attr('data-reference-settings');var M=H.getReferencedData(L,G);var N=F.find('[data-translates]');var O=N.is('*')?jQuery.parseJSON(N.val()):[];F.find('.dropdown-submenu').on('mousemove',this.fixDropDownPosition);var P,checkers,cookieName=H.getName()+'-'+G+'-checkers',mouseIn=false;var Q=function(){};var R=function(){var a=F.find('.box-inner').find('ul');a.find('li:not(.all-select-li):not(.all-select-searched-li)').remove()};this.getCookieName=function(){return cookieName};this.destroy=function(){R()};this.create=function(a,b){Q(a,b)};var S=function(a){mesour.filter.applyDropDown(H.getName(),H.getDropDownLink(),a)};Q=function(d,e){d=!d?H.getData():d;if(!d&&!M)return;var f={};if(M){for(var x in M){if(!M.hasOwnProperty(x)){continue}var g=J(M[x]);f[g]={val:L===mesour.filter.PREDEFINED_KEY?x:g,translated:I.translateVariable(M[x]),keys:[0]}}}else{for(var x=0;x<d.length;x++){if(typeof d[x][G]==='undefined'){throw new Error('MesourFilterDropDownException: Column "'+G+'" does not exists in data.');}if(!f[d[x][G]]){var g=J(d[x][G]);f[g]={val:g,translated:I.translateVariable(d[x][G]),keys:[x]}}else{f[d[x][G]].keys.push(x)}}}if(!K){var h=F.find('.box-inner').find('ul');for(var y in f){if(!f[y].val&&Number(f[y].val)!==0)continue;var j=$('<li>'),id=G+((f[y].val&&typeof f[y].val.replace==='function')?f[y].val.replace(' ',''):f[y].val);j.append('<input type="checkbox" class="checker" data-value="'+f[y].val+'" id="'+id+'">');j.append('&nbsp;');j.append('<label for="'+id+'">'+f[y].translated+'</label>');h.append(j)}}else if(K==='date'){var k=[],months={},special={};for(var y in f){if(!f[y].val)continue;var l=isNaN(f[y].val);if(f[y].val){if(f[y].val===mesour.filter.VALUE_NULL||f[y].val===mesour.filter.VALUE_TRUE||f[y].val===mesour.filter.VALUE_FALSE){special[f[y].val]=f[y];continue}}var m=l?mesour.core.strtotime(f[y].val):f[y].val;var n=mesour.core.phpDate('Y',m);var o=mesour.core.phpDate('n',m);var p=mesour.core.phpDate('j',m);if(k.indexOf(n)===-1){k.push(n)}if(!months[n]){months[n]={};months[n]['months']=[];months[n]['days']={}}if(months[n]['months'].indexOf(o)===-1){months[n]['months'].push(o)}if(!months[n]['days'][o]){months[n]['days'][o]=[]}if(months[n]['days'][o].indexOf(p)===-1){months[n]['days'][o].push(p)}}k.sort(function(a,b){return b-a});var h=F.find('.box-inner').find('ul');for(var i in special){if(!special.hasOwnProperty(i)){continue}var j=$('<li>'),id=G+((special[i].val&&typeof special[i].val.replace==='function')?special[i].val.replace(' ',''):special[i].val);j.append('<input type="checkbox" class="checker" data-value="'+special[i].val+'" id="'+id+'">');j.append('&nbsp;');j.append('<label for="'+id+'">'+special[i].translated+'</label>');h.append(j)}var q=mesour.cookie(cookieName),checkersInfo=q?jQuery.parseJSON(q):{};for(var a in k){if(!k.hasOwnProperty(a)){continue}var r='year-'+k[a];var s=checkersInfo[r]?true:false;var t=$('<li>');t.append('<span class="'+H.getIconClass(s?mesour.filter.ICON_MINUS:mesour.filter.ICON_PLUS)+' toggle-sub-ul" data-name="'+r+'"></span>');t.append('&nbsp;');t.append('<input type="checkbox" class="checker">');t.append('&nbsp;');t.append('<label>'+k[a]+'</label>');t.append('<span class="close-all">(<a href="#">Close all</a>)</span>');var u=$('<ul class="toggled-sub-ul">');t.append(u);if(s){u.show();t.find('.close-all').show()}months[k[a]].months.sort(function(a,b){return a-b});var o=months[k[a]].months;for(var b in o){var v='month-'+k[a]+'-'+o[b];var w=checkersInfo[v]?true:false;var z=$('<li>');z.append('<span class="'+H.getIconClass(w?mesour.filter.ICON_MINUS:mesour.filter.ICON_PLUS)+' toggle-sub-ul" data-name="'+v+'"></span>');z.append('&nbsp;');z.append('<input type="checkbox" class="checker">');z.append('&nbsp;');z.append('<label>'+mesour.filter.translations.months[o[b]]+'</label>');u.append(z);var A=$('<ul class="toggled-sub-ul">');z.append(A);if(w){A.show()}months[k[a]].days[o[b]].sort(function(a,b){return a-b});var B=months[k[a]].days[o[b]];for(var c in B){var C=mesour.core.strtotime(k[a]+'-'+o[b]+'-'+B[c]);var D=l?mesour.core.phpDate(H.getPhpDateFormat(),C):C;var E=$('<li>');E.append('<span class="'+H.getIconPrefix()+'">&nbsp;</span>');E.append('<input type="checkbox" class="checker" data-value="'+D+'">');E.append('&nbsp;');E.append('<label>'+B[c]+'</label>');A.append(E)}}h.append(t)}}if(e){checkers=new mesour.filter.Checkers(I)}};Q();this.getName=function(){return G};this.getType=function(){return!K?'text':K};this.getElement=function(){return F};this.getValues=function(a){var b=H.getValues(G);if(!a){return b}else{if(!b[a]){return{}}else{return b[a]}}};this.setValues=function(a,b){var c=H.getValues(G);c[b]=a;H.setValues(c,G)};this.unsetValues=function(a){var b=H.getValues(G);delete b[a];H.setValues(b,G)};this.getFilter=function(){return H};P=new mesour.filter.CustomFilter(this);checkers=new mesour.filter.Checkers(this);this.update=function(){var a=I.getValues(),toggle_button=F.find('.dropdown-toggle'),menu=F.find('.dropdown-menu'),first_submenu=menu.children('.dropdown-submenu');toggle_button.find('[data-filter-icon="check"]').hide();first_submenu.find('[data-filter-icon]').closest('button').hide();F.removeClass('active-item').removeClass('active-checkers');if(a){if(a.custom&&a.custom.operator){toggle_button.find('[data-filter-icon="check"]').show();F.addClass('active-item');first_submenu.find('[data-filter-icon]').closest('button').show()}if(a.checkers&&typeof a.checkers[0]!=='undefined'){toggle_button.find('[data-filter-icon="check"]').show();F.addClass('active-checkers');for(var x=0;x<a.checkers.length;x++){checkers.check(a.checkers[x])}}}};this.toggle=function(){if(I.isOpened()){I.close()}else{I.open()}};this.isOpened=function(){return F.hasClass('open')};this.open=function(){H.closeAll(F);F.addClass('open');S({id:I.getName(),opened:1})};this.close=function(){I.update();F.removeClass('open');S({id:I.getName(),opened:0})};F.on({mouseenter:function(){mouseIn=true},mouseleave:function(){mouseIn=false}});$('.mesour-filter-modal').on({mouseenter:function(){mouseIn=true},mouseleave:function(){mouseIn=false}});$('html').on('click.filter-el-'+G,function(){if(I.isOpened()&&!mouseIn){I.close()}});F.children('button').on('click',function(e){e.preventDefault();H.closeAll(F);I.toggle(F)});F.find('.reset-filter').on({click:function(){I.unsetValues('custom');I.update();I.save();H.apply()},mouseenter:function(){$(this).removeClass('btn-success').addClass('btn-danger').find('[data-filter-icon]').hide().filter('[data-filter-icon="reset"]').show()},mouseleave:function(){$(this).removeClass('btn-danger').addClass('btn-success').find('[data-filter-icon]').hide().filter('[data-filter-icon="has-custom"]').show()}});F.find('.close-filter').on('click',function(e){e.preventDefault();I.update();I.close()});this.save=function(){var a=checkers.getChecked();if(a.length>0){I.setValues(I.getFilter().generateNextPriority(),'priority');I.setValues(a,'checkers');I.setValues(K!=='date'?'text':'date','type')}else{I.unsetValues('priority');I.unsetValues('checkers')}};this.update()};